<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PoP Character Creator</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style type="text/css">
        .table thead th {
            font-size: 12px;
        }
        .table td {
            text-align: center;
        }
        .totalRow th, .totalRow td {
            font-size: 20px;
            font-weight: 700;
            border-top: 2px solid #dee2e6;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $( document ).ready(function() {
            var attrs = ["Strength", "Agility", "Intelligence", "Charisma"];
            var skills = ["Ironflesh", "Power Strike", "Power Throw", "Power Draw", "Weapon Master", "Shield", "Athletics", "Riding", "Horse Archery", "Looting", "Trainer", "Tracking", "Tactics", "Path-finding", "Spotting", "Inventory Managment", "Wound Treatment", "Surgery", "First Aid", "Engineer", "Persuasion", "Prisoner Management", "Leadership", "Trade"];
            var profs = ["One Handed Weapons", "Two Handed Weapons", "Polearms", "Archery", "Crossbows", "Throwing"];
            var notes = ["Empire Relation", "Fierdsvain Relation", "Sarleon Relation", "Ravenstern relation", "D'Shar Relation", "Inquisition Relation", "Griffon Relation", "Lion Relation", "Renegade Knights Relation", "Adventurer Companies Relation", "Snake Cult Relation", "D'Shar Raiders Relation", "Singalians Relation", "King Ulric Relation", "Kadan Bahadur Khan Relation"];
            var base = {
                attrs: {
                    "Strength" : 6,
                    "Agility" : 5,
                    "Intelligence" : 4,
                    "Charisma" : 5,
                },
                skills: {
                    "Riding" : 1,
                    "Prisoner Management" : 2,
                    "Leadership" : 1,
                },
                profs: {
                    "One Handed Weapons" : 15,
                    "Two Handed Weapons" : 15,
                    "Polearms" : 15,
                    "Archery" : 15,
                    "Crossbows" : 15,
                    "Throwing" : 15,
                },
                gold: 300,
                rumor: 7
            };
            var stages = [
                [
                    {
                        text: "Male",
                        depends: -1,
                        attrs: {
                            "Strength" : 1,
                            "Charisma" : 2,
                        },
                        skills: {}
                    },
                    {
                        text: "Female",
                        depends: -1,
                        attrs: {
                            "Agility" : 2,
                            "Intelligence" : 1,
                        },
                        skills: {}
                    }
                ],
                [
                    {
                        text: "A minor noble",
                        depends: 0,
                        attrs: [
                            {
                                "Strength" : 1,
                                "Intelligence" : 2,
                                "Charisma" : 2,
                            },
                            {
                                "Intelligence" : 2,
                                "Charisma" : 3,
                            },
                        ],
                        skills: [
                            {
                                "Power Strike" : 2,
                                "Weapon Master" : 1,
                                "Shield" : 2,
                                "Riding" : 2,
                                "Tactics" : 2,
                                "Leadership" : 3,
                            },
                            {
                                "Power Strike" : 1,
                                "Riding" : 2,
                                "Wound Treatment" : 1,
                                "First Aid" : 2,
                                "Persuasion" : 2,
                                "Leadership" : 2,
                                "Power Draw" : 1,
                                "Tactics" : 1,
                            },
                        ],
                        profs: [
                            {
                                "One Handed Weapons" : 40,
                                "Two Handed Weapons" : 40,
                                "Polearms" : 40,
                            },
                            {
                                "One Handed Weapons" : 40,
                            },
                        ],
                        gold: [300, 300],
                        honor: [1, 0],
                        renown: [100, 60],
                        items: [["Fine Cross Hilt Noble Sword"], ["Balanced Cross Hilt Noble Sword", "Spirited Courser"]],
                        notes: [
                            [[0, -10]],
                            [[0, -10]]
                        ]
                    },
                    {
                        text: "A merchant ship captain",
                        depends: -1,
                        attrs: {
                            "Intelligence" : 2,
                            "Charisma" : 4,
                        },
                        skills: {
                            "Power Strike" : 1,
                            "Riding" : 1,
                            "Looting" : 1,
                            "Path-finding" : 2,
                            "Inventory Management" : 3,
                            "Persuasion" : 1,
                            "Trade" : 3,
                        },
                        profs: {
                            "Two Handed Weapons" : 20,
                        },
                        gold: 3000,
                        renown: 20,
                        items: ["Tabard", "Pottery x2"],
                        notes: [[1, 5]]
                    },
                    {
                        text: "A former knight",
                        depends: -1,
                        attrs: {
                            "Strength" : 3,
                            "Agility" : 2,
                            "Charisma" : 1,
                        },
                        skills: {
                            "Ironflesh" : 1,
                            "Power Strike" : 2,
                            "Weapon Master" : 1,
                            "Shield" : 1,
                            "Athletics" : 1,
                            "Riding" : 2,
                            "Trainer" : 3,
                            "Tactics" : 1,
                        },
                        profs: {
                            "One Handed Weapons" : 60,
                            "Two Handed Weapons" : 65,
                            "Polearms" : 60,
                        },
                        gold: 350,
                        renown: 10,
                        items: ["White and Green Long Surcoat"],
                        notes: [[2, -10]],
                        other: ["A) randomly select Dragons or Eventide, then -5 to the current relation, B) repeat A one more time"]
                    },
                    {
                        text: "A retired adventurer",
                        depends: -1,
                        attrs: {
                            "Strength" : 2,
                            "Agility" : 2,
                            "Intelligence" : 2,
                        },
                        skills: {
                            "Power Strike" : 2,
                            "Power Draw" : 1,
                            "Weapon Master" : 1,
                            "Athletics" : 1,
                            "Riding" : 2,
                            "Looting" : 2,
                            "Tracking" : 1,
                            "Path-finding" : 1,
                            "Spotting" : 1,
                        },
                        profs: {
                            "One Handed Weapons" : 40,
                            "Two Handed Weapons" : 30,
                            "Polearms" : 30,
                            "Archery" : 40,
                        },
                        gold: 350,
                        items: ["Mail with Surcoat", "Singalian Arrows"]
                    },
                    {
                        text: "A wandering nomad clan leader",
                        depends: 0,
                        attrs: [
                            {
                                "Strength" : 3,
                                "Agility" : 2,
                                "Intelligence" : 1,
                            },
                            {
                                "Strength" : 1,
                                "Agility" : 2,
                                "Intelligence" : 2,
                                "Charisma" : 1,
                            },
                        ],
                        skills: [
                            {
                                "Power Draw" : 2,
                                "Athletics" : 1,
                                "Riding" : 2,
                                "Horse Archery" : 2,
                                "Path-finding" : 2,
                                "Spotting" : 2,
                                "First Aid" : 1,
                            },
                            {
                                "Athletics" : 1,
                                "Riding" : 3,
                                "Horse Archery" : 1,
                                "Looting" : 1,
                                "Tracking" : 1,
                                "Path-finding" : 3,
                                "Wound Treatment" : 1,
                                "First Aid" : 1,
                            },
                        ],
                        profs: [
                            {
                                "One Handed Weapons" : 20,
                                "Polearms" : 10,
                                "Archery" : 50,
                                "Throwing" : 10,
                            },
                            {
                                "One Handed Weapons" : 5,
                                "Archery" : 30,
                                "Throwing" : 15,
                            },
                        ],
                        gold: [150, 120],
                        renown: [10, 0],
                        items: [["D'Shar Mail Shirt"], ["D'Shar Courser"]],
                        notes: [
                            [[4, -10], [5, -10]], 
                            [[4, -10], [5, -10]]
                        ]
                    },
                    {
                        text: "A rough and mysterious figure",
                        depends: -1,
                        attrs: {
                            "Agility" : 4,
                            "Intelligence" : 2,
                        },
                        skills: {
                            "Power Throw" : 3,
                            "Athletics" : 2,
                            "Looting" : 3,
                            "Tactics" : 2,
                            "Spotting" : 2,
                            "Persuasion" : 1,
                            "Inventory Management" : 1,
                            "First Aid" : 1,
                            "Prisoner Management" : 1,
                            "Trade" : 2,
                            "Tracking" : 1,
                        },
                        profs: {
                            "One Handed Weapons" : 30,
                            "Crossbows" : 50,
                            "Throwing" : 50,
                        },
                        gold: 25
                    },
                    {
                        text: "A respectable physician",
                        depends: -1,
                        attrs: {
                            "Strength" : 1,
                            "Agility" : 2,
                            "Intelligence" : 3,
                        },
                        skills: {
                            "Riding" : 1,
                            "Path-finding" : 2,
                            "Inventory Management" : 1,
                            "Wound Treatment" : 3,
                            "Surgery" : 3,
                            "First Aid" : 3,
                            "Prisoner Management" : 1,
                            "Leadership" : 1,
                            "Trade" : 2,
                        },
                        profs: {
                            "One Handed Weapons" : 10,
                            "Crossbows" : 20,
                        },
                        gold: 1010,
                        renown: 30,
                        items: ["The complete Manual of Herbal Remedies of Pendor (Book)"]
                    }
                ],
                [
                    {
                        text: "Arranged for you to serve a minor Barclay Noble",
                        depends: -1,
                        attrs: {
                            "Strength" : 1,
                            "Intelligence" : 1,
                            "Charisma" : 2,
                        },
                        skills: {
                            "Power Strike" : 1,
                            "Persuasion" : 2,
                            "Leadership" : 1,
                            "Trainer" : 1,
                        },
                        profs: {
                            "One Handed Weapons" : 25,
                            "Polearms" : 5,
                        },
                        renown: 15
                    },
                    {
                        text: "Sent you to be an apprentice to the local guild craftsman",
                        depends: -1,
                        attrs: {
                            "Strength" : 1,
                            "Intelligence" : 2,
                            "Charisma" : 1,
                        },
                        skills: {
                            "Inventory Management" : 2,
                            "Engineer" : 2,
                            "Trade" : 1,
                        },
                        profs: {
                            "Crossbows" : 30,
                        },
                        gold: 600,
                        items: ["Steel Bolts"]
                    },
                    {
                        text: "Put you in the care of a successful merchant",
                        depends: -1,
                        attrs: {
                            "Intelligence" : 3,
                            "Charisma" : 1,
                        },
                        skills: {
                            "Looting" : 1,
                            "Inventory Management" : 2,
                            "Trade" : 1,
                            "Athletics" : 1,
                        },
                        profs: {},
                        gold: 1500
                    },
                    {
                        text: "Left you to fend for yourself",
                        depends: -1,
                        attrs: {
                            "Agility" : 2,
                            "Intelligence" : 2,
                        },
                        skills: {
                            "Athletics" : 1,
                            "Looting" : 2,
                            "Spotting" : 1,
                            "Ironflesh" : 1,
                        },
                        profs: {
                            "One Handed Weapons" : 25,
                            "Crossbows" : 25,
                            "Throwing" : 15,
                        },
                        rumor: 4
                    },
                    {
                        text: "Sent you out on your own to hunt in the wilds",
                        depends: -1,
                        attrs: {
                            "Strength" : 2,
                            "Agility" : 2,
                        },
                        skills: {
                            "Horse Archery" : 2,
                            "Tracking" : 1,
                            "Path-finding" : 1,
                            "Spotting" : 1,
                        },
                        profs: {
                            "Archery" : 35,
                        },
                        gold: 100,
                        renown: 5,
                        items: ["Dark Steppe Horse"]
                    }
                ],
                [
                    {
                        text: "A squire/A lady-in-waiting",
                        depends: 0,
                        attrs: [
                            {
                                "Strength" : 1,
                                "Agility" : 1,
                            },
                            {
                                "Intelligence" : 1,
                                "Charisma" : 1,
                            },
                        ],
                        skills: [
                            {
                                "Power Strike" : 2,
                                "Weapon Master" : 1,
                                "Shield" : 2,
                                "Riding" : 1,
                                "Trainer" : 1,
                                "Leadership" : 1,
                            },
                            {
                                "Riding" : 2,
                                "Tactics" : 1,
                                "Wound Treatment" : 1,
                                "Persuasion" : 2,
                                "Leadership" : 2,
                            },
                        ],
                        profs: [
                            {
                                "One Handed Weapons" : 30,
                                "Two Handed Weapons" : 30,
                                "Polearms" : 30,
                                "Archery" : 10,
                                "Crossbows" : 30,
                                "Throwing" : 10,
                            },
                            {
                                "One Handed Weapons" : 10,
                                "Crossbows" : 35,
                            },
                        ],
                        gold: [100, 100],
                        items: [["Red Surcoat on Fine Mail"], ["Spirited Courser"]]
                    },
                    {
                        text: "A bard",
                        depends: -1,
                        attrs: {
                            "Charisma" : 2,
                        },
                        skills: {
                            "Weapon Master" : 1,
                            "Looting" : 1,
                            "Path-finding" : 2,
                            "Persuasion" : 2,
                            "Leadership" : 2,
                        },
                        profs: {
                            "One Handed Weapons" : 25,
                            "Crossbows" : 30,
                        },
                        gold: 200,
                        items: ["Lute"],
                        rumor: 4
                    },
                    {
                        text: "A scholar at a local Barclay university",
                        depends: -1,
                        attrs: {
                            "Intelligence" : 2,
                        },
                        skills: {
                            "Wound Treatment" : 2,
                            "Surgery" : 2,
                            "First Aid" : 2,
                        },
                        profs: {
                            "One Handed Weapons" : 20,
                            "Crossbows" : 20,
                        },
                        gold: 700,
                        items: ["Random Book"]
                    },
                    {
                        text: "A self employed merchant",
                        depends: -1,
                        attrs: {
                            "Intelligence" : 1,
                            "Charisma" : 1,
                        },
                        skills: {
                            "Riding" : 1,
                            "Looting" : 1,
                            "Path-finding" : 1,
                            "Inventory Management" : 2,
                            "Persuasion" : 1,
                            "Trade" : 2,
                        },
                        profs: {
                            "One Handed Weapons" : 15,
                        },
                        gold: 1200,
                        items: ["Winged Mace"],
                        rumor: 5
                    },
                    {
                        text: "An engineer and builder",
                        depends: -1,
                        attrs: {
                            "Strength" : 1,
                            "Intelligence" : 1,
                        },
                        skills: {
                            "Tactics" : 2,
                            "Inventory Management" : 2,
                            "Engineer" : 3,
                            "Athletics" : 1,
                        },
                        profs: {
                            "One Handed Weapons" : 15,
                        },
                        gold: 700
                    },
                    {
                        text: "A tracker and hunter",
                        depends: -1,
                        attrs: {
                            "Strength" : 1,
                            "Agility" : 1,
                        },
                        skills: {
                            "Power Draw" : 2,
                            "Athletics" : 2,
                            "Riding" : 1,
                            "Tracking" : 1,
                            "Spotting" : 2,
                        },
                        profs: {
                            "Polearms" : 20,
                            "Archery" : 35,
                        },
                        gold: 200,
                        items: ["Short Composite Bow", "Furs X2"],
                        rumor: 6
                    }
                ],
                [
                    {
                        text: "You must right a wrong done to you",
                        depends: 3,
                        attrs: [
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                        ],
                        skills: [
                            {
                                "Power Strike" : 1,
                                "Athletics" : 1,
                                "Tactics" : 1,
                                "Path-finding" : 1,
                                "Spotting" : 1,
                            },
                            {
                                "Power Strike" : 1,
                                "Athletics" : 1,
                                "Tactics" : 2,
                                "Path-finding" : 1,
                                "Spotting" : 1,
                            },
                            {
                                "Power Strike" : 1,
                                "Athletics" : 1,
                                "Tactics" : 1,
                                "Path-finding" : 1,
                                "Spotting" : 2,
                            },
                            {
                                "Ironflesh" : 1,
                                "Power Strike" : 1,
                                "Athletics" : 1,
                                "Tactics" : 1,
                                "Path-finding" : 1,
                                "Spotting" : 1,
                            },
                            {
                                "Power Strike" : 1,
                                "Athletics" : 1,
                                "Tactics" : 1,
                                "Path-finding" : 1,
                                "Spotting" : 1,
                            },
                            {
                                "Power Strike" : 1,
                                "Athletics" : 1,
                                "Tactics" : 1,
                                "Path-finding" : 1,
                                "Spotting" : 1,
                            },
                        ],
                        profs: [
                            {
                                "One Handed Weapons" : 20,
                            },
                            {
                                "One Handed Weapons" : 10,
                                "Crossbows" : 20,
                            },
                            {},
                            {},
                            {},
                            {
                                "One Handed Weapons" : 10,
                                "Archery" : 20,
                            },
                        ],
                        gold: [100, 0, 0, 200, 100, 0]
                    },
                    {
                        text: "You received a message that your father has died",
                        depends: 1,
                        attrs: [
                            {
                                "Agility" : 1,
                                "Charisma" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Charisma" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Charisma" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Charisma" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Charisma" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Charisma" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Charisma" : 2,
                            },
                        ],
                        skills: [
                            {
                                "Ironflesh" : 1,
                                "Spotting" : 2,
                                "First Aid" : 2,
                            },
                            {
                                "Ironflesh" : 1,
                                "Spotting" : 2,
                                "First Aid" : 2,
                            },
                            {
                                "Ironflesh" : 1,
                                "Spotting" : 2,
                                "First Aid" : 2,
                            },
                            {
                                "Ironflesh" : 1,
                                "Spotting" : 2,
                                "First Aid" : 2,
                            },
                            {
                                "Ironflesh" : 1,
                                "Spotting" : 2,
                                "First Aid" : 2,
                            },
                            {
                                "Ironflesh" : 1,
                                "Spotting" : 2,
                                "First Aid" : 2,
                            },
                            {
                                "Ironflesh" : 1,
                                "Spotting" : 2,
                                "First Aid" : 2,
                            },
                        ],
                        gold: [0, 1000, 0, 0, 0, 100, 0],
                        items: [["Crude Coat of Plates - Yellow"], [], ["Sarleon Knight Longsword"], ["Barclay Plate and Chain"], ["D'Shar Bow", "Scimitar"], ["Assassin Throwing Knives"], ["The Field Surgeon's Handbook (Book)"]]
                    },
                    {
                        text: "A series of unfortunate events",
                        depends: 3,
                        attrs: [
                            {
                                "Agility" : 3,
                            },
                            {
                                "Agility" : 3,
                            },
                            {
                                "Agility" : 3,
                            },
                            {
                                "Agility" : 3,
                            },
                            {
                                "Agility" : 3,
                            },
                            {
                                "Agility" : 3,
                            },
                        ],
                        skills: [
                            {
                                "Riding" : 1,
                                "Tactics" : 3,
                                "Path-finding" : 2,
                                "Spotting" : 1,
                            },
                            {
                                "Riding" : 1,
                                "Looting" : 1,
                                "Tactics" : 1,
                                "Path-finding" : 2,
                                "Spotting" : 1,
                                "Persuasion" : 1,
                            },
                            {
                                "Riding" : 1,
                                "Tactics" : 3,
                                "Path-finding" : 2,
                                "Spotting" : 1,
                            },
                            {
                                "Riding" : 1,
                                "Tactics" : 1,
                                "Path-finding" : 2,
                                "Spotting" : 1,
                                "Trade" : 1,
                                "Prisoner Management" : 1,
                            },
                            {
                                "Riding" : 1,
                                "Tactics" : 1,
                                "Path-finding" : 2,
                                "Spotting" : 1,
                                "Engineer" : 2,
                            },
                            {
                                "Riding" : 2,
                                "Tactics" : 1,
                                "Path-finding" : 3,
                                "Spotting" : 1,
                            },
                        ],
                        gold: [100, 0, 100, 0, 100, 0]
                    },
                    {
                        text: "Too many enemies that seek to end your life",
                        depends: 3,
                        attrs: [
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                            {
                                "Strength" : 2,
                                "Intelligence" : 1,
                            },
                        ],
                        skills: [
                            {
                                "Weapon Master" : 1,
                                "Looting" : 1,
                                "Tactics" : 1,
                                "Persuasion" : 1,
                                "Trade" : 1,
                            },
                            {
                                "Weapon Master" : 1,
                                "Looting" : 1,
                                "Tactics" : 1,
                                "Persuasion" : 1,
                                "Trade" : 1,
                            },
                            {
                                "Weapon Master" : 1,
                                "Looting" : 1,
                                "Tactics" : 1,
                                "Surgery" : 1,
                                "Persuasion" : 1,
                                "Trade" : 1,
                            },
                            {
                                "Weapon Master" : 1,
                                "Looting" : 1,
                                "Tactics" : 2,
                                "Persuasion" : 1,
                                "Trade" : 1,
                            },
                            {
                                "Weapon Master" : 1,
                                "Looting" : 1,
                                "Tactics" : 1,
                                "Persuasion" : 2,
                                "Trade" : 1,
                            },
                            {
                                "Weapon Master" : 1,
                                "Looting" : 1,
                                "Tactics" : 1,
                                "Persuasion" : 1,
                                "Prisoner Management" : 1,
                                "Trade" : 1,
                            },
                        ],
                        gold: [0, 0, 0, 0, 100, 0]
                    },
                    {
                        text: "A letter that changed your life forever",
                        depends: 1,
                        attrs: [
                            {
                                "Agility" : 1,
                                "Intelligence" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Intelligence" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Intelligence" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Intelligence" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Intelligence" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Intelligence" : 2,
                            },
                            {
                                "Agility" : 1,
                                "Intelligence" : 2,
                            },
                        ],
                        skills: [
                            {
                                "Path-finding" : 1,
                            },
                            {
                                "Path-finding" : 1,
                            },
                            {
                                "Path-finding" : 1,
                            },
                            {
                                "Path-finding" : 1,
                            },
                            {
                                "Path-finding" : 1,
                            },
                            {
                                "Path-finding" : 1,
                            },
                            {
                                "Path-finding" : 1,
                            },
                        ],
                        gold: [0, 800, 0, 0, 0, 500, 500],
                        honor: [2, 2, 13, 3, 3, 0, 3],
                        renown: [0, 10, 30, 10, 10, 0, 10],
                        items: [[], [], ["Exquisite Sarleon Knight Longsword"], ["Old Barclay Plate and Chain"], [], ["Metal Spiked Mace"], []],
                        notes: [
                            [[0, -10], [2, -10], [3, -10], [10, -20], [13, -10], [6, 15], [7, -5]],
                            [[0, -10], [2, -10], [3, -10], [10, -20], [13, -10], [1, 5]],
                            [[0, -10], [2, -10], [3, -10], [10, -20], [13, -10], [8, 10]],
                            [[0, -10], [2, -10], [3, -10], [10, -20], [13, -10], [9, 10]],
                            [[0, -10], [2, -10], [3, -10], [10, -20], [13, -10], [12, -10], [11, 10], [14, -5]],
                            [[0, -10], [2, -10], [3, -10], [10, -20], [13, -10]],
                            [[0, -10], [2, -10], [3, -10], [10, -20], [13, -10]]
                        ],
                        other: [
                            ["Will always allow creating Griffon chapter"],
                            ["Will always allow creating Griffon chapter"],
                            ["Will always allow creating Griffon chapter"],
                            ["Will always allow creating Griffon chapter"],
                            ["Will always allow creating Griffon chapter"],
                            ["Will always allow creating Griffon chapter"],
                            ["Will always allow creating Griffon chapter"]
                        ]
                    }
                ]
            ];
            
            // add headers
            var headers = "<th scope=\"col\">#</th>";
            for(var i = 0; i < attrs.length; i++) {
                headers += "<th scope=\"col\">" + attrs[i] + "</th>";
            }
            for(var i = 0; i < skills.length; i++) {
                headers += "<th scope=\"col\">" + skills[i] + "</th>";
            }
            
            $("#resTab > thead > tr").html(headers);
            
            // add base values
            var sttext = "";
            sttext += "<tr>";
            sttext += "<th scope=\"row\">Base</th>";
            for(var i = 0; i < attrs.length; i++) {
                sttext += "<td>" + (!!base.attrs[attrs[i]] ? base.attrs[attrs[i]] : 0) + "</td>";
            }
            for(var i = 0; i < skills.length; i++) {
                sttext += "<td>" + (!!base.skills[skills[i]] ? base.skills[skills[i]] : '') + "</td>";
            }
            sttext += "</tr>";
            
            // add stages
            for(var i = 0; i < stages.length; i++) {
                sttext += "<tr>";
                sttext += "<th class=\"ft\" scope=\"row\">";
                sttext += "<select class=\"form-control\" id=\"stage" + i + "\">";
                sttext += "<option value=\"-1\">(Please select one)</option>";
                
                // add options
                for(var j = 0; j < stages[i].length; j++) {
                    sttext += "<option value=\"" + j + "\">" + stages[i][j].text + "</option>";
                }
                
                sttext += "</select>";
                sttext += "</th>";
                
                // add cells
                var total = attrs.length + skills.length;
                for(var j = 0; j < total; j++) {
                    sttext += "<td></td>";
                }
                sttext += "</tr>";
            }
            
            // add sum row
            sttext += "<tr class=\"totalRow\">";
            sttext += "<th scope=\"row\">Total</th>";
            
            // add cells
            var total = attrs.length + skills.length;
            for(var j = 0; j < total; j++) {
                sttext += "<td></td>";
            }
            sttext += "</tr>";
            $('#resTab > tbody').html(sttext);
            
            // update values on change
            $('select').on('change', function() {
                var copyAttr = [];
                for (var i = 0; i < attrs.length; i++) {
                    copyAttr[attrs[i]] = !!base.attrs[attrs[i]] ? base.attrs[attrs[i]] : 0;
                }
                
                var copySkill = [];
                for (var i = 0; i < skills.length; i++) {
                    copySkill[skills[i]] = !!base.skills[skills[i]] ? base.skills[skills[i]] : 0;
                }
                
                var copyProf = [];
                for (var i = 0; i < profs.length; i++) {
                    copyProf[profs[i]] = !!base.profs[profs[i]] ? base.profs[profs[i]] : 0;
                }
                
                var gold = 300;
                var honor = 0;
                var renown = 0;
                var rumor = 7;
                var items = "<li class=\"list-group-item active\">Items</li>";
                var other = "";
                var noteVals = [];
                for(var i = 0; i < notes.length; i++)
                    noteVals[i] = 0;
                
                for(var i = 0; i < stages.length; i++) {
                    var sel = $('#stage' + i).val();
                    var cells = $('#resTab > tbody > tr:nth-child(' + (i+2) + ') > td');
                    if(sel == -1) {
                        cells.each(function(n, item){
                            $(item).html('');
                        });
                    }
                    else {
                        var dep = stages[i][sel].depends;
                        var val = 0;
                        if(dep == -1) {
                            // fill in attr and skill values
                            cells.each(function(n, item){
                                if(n < attrs.length) {
                                    val = stages[i][sel].attrs[attrs[n]];
                                    copyAttr[attrs[n]] += (!!val ? val : 0);
                                }
                                else {
                                    val = stages[i][sel].skills[skills[n - attrs.length]];
                                    copySkill[skills[n - attrs.length]] += (!!val ? val : 0);
                                }
                                if(!!val)
                                    $(item).html(val);
                                else
                                    $(item).html('');
                            });
                            
                            // add other things
                            if('profs' in stages[i][sel])
                                for(var j= 0; j < profs.length; j++) {
                                    copyProf[j] += !!stages[i][sel].profs[profs[j]] ? stages[i][sel].profs[profs[j]] : 0;
                                }
                            
                            if('gold' in stages[i][sel])
                                gold += stages[i][sel].gold;
                            if('honor' in stages[i][sel])
                                honor += stages[i][sel].honor;
                            if('renown' in stages[i][sel])
                                renown += stages[i][sel].renown;
                            if('rumor' in stages[i][sel])
                                if(stages[i][sel].rumor < rumor)
                                    rumor = stages[i][sel].rumor;
                            if('items' in stages[i][sel])
                                for(var j= 0; j < stages[i][sel].items.length; j++) {
                                    items += "<li class=\"list-group-item\">&#x25C9; " + stages[i][sel].items[j] + "</li>";
                                }
                            if('notes' in stages[i][sel])
                                for(var j= 0; j < stages[i][sel].notes.length; j++)
                                    noteVals[stages[i][sel].notes[j][0]] += stages[i][sel].notes[j][1];
                            if('other' in stages[i][sel])
                                for(var j= 0; j < stages[i][sel].other.length; j++) {
                                    other += "<li class=\"list-group-item\">&#x25C9; " + stages[i][sel].other[j] + "</li>";
                                }
                        }
                        else {
                            var depSel = $('#stage' + dep).val();
                            if(depSel == -1) {
                                cells.each(function(n, item){
                                    $(item).html('');
                                });
                            }
                            else {
                                cells.each(function(n, item){
                                    if(n < attrs.length) {
                                        val = stages[i][sel].attrs[depSel][attrs[n]];
                                        copyAttr[attrs[n]] += (!!val ? val : 0);
                                    }
                                    else {
                                        val = stages[i][sel].skills[depSel][skills[n - attrs.length]];
                                        copySkill[skills[n - attrs.length]] += (!!val ? val : 0);
                                    }
                                    if(!!val)
                                        $(item).html(val);
                                    else
                                        $(item).html('');
                                });
                                
                                // add other things
                                if('profs' in stages[i][sel])
                                    for(var j= 0; j < profs.length; j++) {
                                        copyProf[profs[j]] += !!stages[i][sel].profs[depSel][profs[j]] ? stages[i][sel].profs[depSel][profs[j]] : 0;
                                    }
                                
                                if('gold' in stages[i][sel])
                                    gold += stages[i][sel].gold[depSel];
                                if('honor' in stages[i][sel])
                                    honor += stages[i][sel].honor[depSel];
                                if('renown' in stages[i][sel])
                                    renown += stages[i][sel].renown[depSel];
                                if('rumor' in stages[i][sel])
                                    if(stages[i][sel].rumor < rumor)
                                        rumor = stages[i][sel].rumor[depSel];
                                if('items' in stages[i][sel])
                                    for(var j= 0; j < stages[i][sel].items[depSel].length; j++) {
                                        items += "<li class=\"list-group-item\">&#x25C9; " + stages[i][sel].items[depSel][j] + "</li>";
                                    }
                                if('notes' in stages[i][sel])
                                    for(var j= 0; j < stages[i][sel].notes[depSel].length; j++)
                                        noteVals[stages[i][sel].notes[depSel][j][0]] += stages[i][sel].notes[depSel][j][1];
                                if('other' in stages[i][sel])
                                    for(var j= 0; j < stages[i][sel].other[depSel].length; j++) {
                                        other += "<li class=\"list-group-item\">&#x25C9; " + stages[i][sel].other[depSel][j] + "</li>";
                                    }
                            }
                        }
                    }
                }
                
                var totalSkill = 0;
                var totalWasted = 0;
                var cells = $('#resTab > tbody > tr:nth-child(' + (stages.length+2) + ') > td');
                cells.each(function(n, item){
                    if(n < attrs.length)
                        $(item).html(!!copyAttr[attrs[n]] ? copyAttr[attrs[n]] : '');
                    else {
                        var sum = copySkill[skills[n - attrs.length]];
                        if(sum == 0) {
                            $(item).html('');
                        }
                        else if(sum > 7) {
                            totalSkill += 7;
                            totalWasted += sum - 7;
                            $(item).html(7 + " <span class=\"text-danger\" title=\"Skills are limited at 7!\">-" + (sum - 7) + "</span>");
                        }
                        else {
                            totalSkill += sum;
                            $(item).html(sum);
                        }
                    }
                });
                
                var sltext = "";
                if($('#stage1').val() != 1 && $('#stage1').val() != 4 && $('#stage1').val() != 5)
                    sltext += "<li class=\"list-group-item\">Banner :<span class=\"float-right font-weight-bold text-success\">Yes</span></li>";
                else
                    sltext += "<li class=\"list-group-item\">Banner :<span class=\"float-right font-weight-bold text-danger\">No</span></li>";
                sltext += "<li class=\"list-group-item\">Gold :<span class=\"float-right font-weight-bold\">" + gold + "</span></li>";
                sltext += "<li class=\"list-group-item\">Honor :<span class=\"float-right font-weight-bold\">" + honor + "</span></li>";
                sltext += "<li class=\"list-group-item\">Renown :<span class=\"float-right font-weight-bold\">" + renown + "</span></li>";
                sltext += "<li class=\"list-group-item\">Rumor Interval :<span class=\"float-right font-weight-bold\">" + rumor + "</span></li>";
                sltext += "<li class=\"list-group-item\">Total # of Skills :<span class=\"float-right font-weight-bold\">" + totalSkill;
                if(totalWasted > 0)
                    sltext += " <span class=\"text-danger\" title=\"Skills are limited at 7!\">-" + totalWasted + "</span>";
                sltext += "</span></li>";
                
                var proftext = "<li class=\"list-group-item active\">Weapon Proficiencies</li>";
                for(var i = 0; i < profs.length; i++) {
                    totalSkill += copyProf[profs[i]];
                    proftext += "<li class=\"list-group-item\">" + profs[i] + " :<span class=\"float-right font-weight-bold\">" + copyProf[profs[i]] + "</span></li>";
                }
                
                var notestext = "<li class=\"list-group-item active\">Notes</li>";
                for(var i = 0; i < noteVals.length; i++)
                    if(noteVals[i] > 0)
                        notestext += "<li class=\"list-group-item\">&#x25C9; " + notes[i] + " :<span class=\"float-right font-weight-bold text-success\">" + noteVals[i] + "</span></li>";
                    else if(noteVals[i] < 0)
                        notestext += "<li class=\"list-group-item\">&#x25C9; " + notes[i] + " :<span class=\"float-right font-weight-bold text-danger\">" + noteVals[i] + "</span></li>";
                
                $('#sumList').html(sltext);
                $('#profList').html(proftext);
                $('#itemList').html(items);
                $('#otherList').html(notestext + other);
                
                var link = $('#stage0').val();
                for(var i = 1; i < stages.length; i++) {
                    link += "_" + $('#stage' + i).val();
                }
                var baseurl = window.location.origin+window.location.pathname;
                $('#buildLink').html("&nbsp;Link to the current build: <a href=\"" + baseurl + "#" + link + "\" class=\"alert-link\">" + baseurl +"#" + link + "</a>");
            });
            
            var linked = window.location.hash.substr(1).split('_');
            if(linked != null && linked.length == stages.length) {
                for(var i = 0; i < stages.length; i++) {
                    $('#stage' + i).val(linked[i]);
                }
                $('#stage0').trigger('change');
            }
        });
    </script>
</head>
<body>
    <p class="lead text-center">Mount & Blade: Warband Prophesy of Pendor (3.9.4) Character Creation Tool</p>
    <p class="lead text-center">Please create an issue on <a href="https://github.com/azakhi/azakhi.github.io" class="alert-link">Github page</a> if you find any problems</p>
    
    <p id="buildLink"></p>
    
    <table id="resTab" class="table table-bordered table-dark table-sm table-hover">
        <thead><tr></tr></thead>
        <tbody></tbody>
    </table>
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <ul id="sumList" class="list-group list-group-flush">
                </ul>
            </div>
            <div class="col">
                <ul id="profList" class="list-group list-group-flush">
                </ul>
            </div>
            <div class="col">
                <ul id="itemList" class="list-group list-group-flush">
                </ul>
            </div>
            <div class="col">
                <ul id="otherList" class="list-group list-group-flush">
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
